<h1>My Orders</h1>

<% @orders.each do |order| %>
  <div>
    <h2>Order ##{order.id}</h2>
    <p>Status: <%= order.status %></p>
    <ul>
      <% order.order_items.each do |item| %>
        <li><%= item.food.name %> x <%= item.quantity %></li>
      <% end %>
    </ul>
    <p>Total Price: $<%= order.total_price %></p>
  </div>
<% end %>

<%= form_with(model: @order, url: order_path(@order), method: :patch) do |form| %>
  <%= form.label :status %>
  <%= form.text_field :status %>

  <% @order_items.each do |item| %>
    <div>
      <%= form.label "Item: #{item.food.name}" %>
      <%= form.number_field "order_items_attributes[#{item.id}][quantity]", value: item.quantity %>
      <%= form.hidden_field "order_items_attributes[#{item.id}][id]", value: item.id %>
      <%= form.check_box "order_items_attributes[#{item.id}][_destroy]" %>
      <%= form.label "Remove Item" %>
    </div>
  <% end %>

  <div>
    <%= form.label "Add Item" %>
    <%= form.select :food_id, MenuItem.all.map { |mi| [mi.name, mi.id] } %>
    <%= form.number_field :quantity %>
    <%= form.hidden_field :user_id, value: current_user.id %>
    <%= form.submit "Update Order" %>
  </div>
<% end %>